\NeedsTeXFormat{LaTeX2e}%
\ProvidesClass{epydoc}[2005/03/18 v1.0 Epydoc Python Documentation]

\RequirePackage{ifthen}
\newboolean{@dohyper}
\setboolean{@dohyper}{false}
\newboolean{@domemoir}
\setboolean{@domemoir}{false}

\DeclareOption{index}{\makeindex}
\DeclareOption{hyperref}{\setboolean{@dohyper}{true}}
\DeclareOption*{\PassOptionsToClass{\CurrentOption}{hyperref}}

\ProcessOptions

% \RequirePackage{alltt, parskip, boxedminipage} 
% \RequirePackage{alltt, boxedminipage} 
% \RequirePackage{multirow, longtable, amssymb}
\usepackage{alltt, parskip, fancyheadings, boxedminipage}
\usepackage{makeidx, multirow, longtable, tocbibind, amssymb}

\RequirePackage{fullpage}
% \RequirePackage[headings]{fullpage}

\RequirePackage[usenames]{color}

\setlength{\headheight}{16pt}
\setlength{\headsep}{24pt}
\setlength{\topmargin}{-\headsep}

% \ifthenelse{\boolean{@dohyper}}{%
%     \RequirePackage[usenames]{color}
%     \definecolor{darkblue}{rgb}{0,0.05,0.35}
% %     \RequirePackage[dvips, pagebackref, bookmarks=true, bookmarksopen=false, pdfpagemode=UseOutlines, colorlinks=true, linkcolor=black, anchorcolor=black, citecolor=black, filecolor=black, menucolor=black, pagecolor=black, urlcolor=darkblue]{hyperref}
%     \RequirePackage[urlcolor=blue,linkcolor=blue,bookmarksopen,bookmarksopenlevel=2,pdftex,pagebackref,pdftitle={FiPy}, pdfcreator={epydoc 2.1}, bookmarks=true, bookmarksopen=false, pdfpagemode=UseOutlines,colorlinks=true,plainpages=false,pdfpagelabels]{hyperref}
% }{}

\setlength{\parindent}{0ex}
\setlength{\fboxrule}{2\fboxrule}
\newlength{\BCL} % base class length, for base trees.


% \@ifclassloaded{memoir}{%
%     \RequirePackage[other,notbib]{tocbibind}
% }{%
%     \RequirePackage{fancyhdr,makeidx}
%     \RequirePackage[other]{tocbibind}
%     \pagestyle{fancy}
% }
\pagestyle{fancy}

\renewcommand{\sectionmark}[1]{\markboth{#1}{}}
\renewcommand{\subsectionmark}[1]{\markright{#1}}

\definecolor{py@keywordcolour}{rgb}{1,0.45882,0}
\definecolor{py@stringcolour}{rgb}{0,0.666666,0}
\definecolor{py@commentcolour}{rgb}{1,0,0}
\definecolor{py@ps1colour}{rgb}{0.60784,0,0}
\definecolor{py@ps2colour}{rgb}{0.60784,0,1}
\definecolor{py@inputcolour}{rgb}{0,0,0}
\definecolor{py@outputcolour}{rgb}{0,0,1}
\definecolor{py@exceptcolour}{rgb}{1,0,0}
\definecolor{py@builtincolour}{rgb}{0.58039,0,0.58039}
\definecolor{py@identifiercolour}{rgb}{0,0,0}
\definecolor{py@linenumcolour}{rgb}{0.4,0.4,0.4}
\definecolor{py@inputcolour}{rgb}{0,0,0}
% Prompt
\newcommand{\pysrcprompt}[1]{\textcolor{py@ps1colour}
   {\small\textbf{#1}}}
\newcommand{\pysrcmore}[1]{\textcolor{py@ps2colour}
   {\small\textbf{#1}}}
% Source code
\newcommand{\pysrckeyword}[1]{\textcolor{py@keywordcolour}
   {\small\textbf{#1}}}
\newcommand{\pysrcbuiltin}[1]{\textcolor{py@builtincolour}
   {\small\textbf{#1}}}
\newcommand{\pysrcstring}[1]{\textcolor{py@stringcolour}
   {\small\textbf{#1}}}
\newcommand{\pysrcother}[1]{\small\textbf{#1}}
% Comments
\newcommand{\pysrccomment}[1]{\textcolor{py@commentcolour}
   {\small\textbf{#1}}}
% Output
\newcommand{\pysrcoutput}[1]{\textcolor{py@outputcolour}
   {\small\textbf{#1}}}
% Exceptions
\newcommand{\pysrcexcept}[1]{\textcolor{py@exceptcolour}
   {\small\textbf{#1}}}

\newenvironment{Ventry}[1]%
  {\begin{list}{}{%
    \renewcommand{\makelabel}[1]{\texttt{##1:}\hfil}%
    \settowidth{\labelwidth}{\texttt{#1:}}%
    \setlength{\leftmargin}{\labelsep}%
    \addtolength{\leftmargin}{\labelwidth}}}%
  {\end{list}}


\newcommand{\EpydocHyperlink}[2]{#2}
    
\newcommand{\EpydocHypertarget}[2]{\label{#1}#2}

\newcommand{\EpydocIndex}[2][]{%
    #2 %
    \ifthenelse{\equal{#1}{}}{}{\textit{(\MakeLowercase{#1})}}}
    
\newenvironment{EpydocFunctionGroup}[1][]{%
    \ifthenelse{\equal{#1}{}}{}{%
    \rule{\textwidth}{0.5\fboxrule}
    
    \large{#1}
    
    }}
    {}
    
\newenvironment{EpydocFunction}[2]{%
    \newcommand{\and}{, }%
    \newcommand{\VarArg}[1]{*\textit{##1}}%
    \newcommand{\GenericArg}{\textit{\ldots}}%
    \newcommand{\KWArg}[1]{**\textit{##1}}%
    \newcommand{\ArgList}[1]{(##1)}%
    \newcommand{\Param}[2][]{%
        \textit{##2}%
        \ifthenelse{\equal{##1}{}}{}{=\TX@verb|##1|}}%
    \vspace{0.5ex}
    \def\@EpydocFunctionLine{%
        \vspace{-1.5ex}
            \rule{\textwidth}{0.5\fboxrule}
        \aftergroup\def\aftergroup\@EpydocFunctionLine\aftergroup{\aftergroup}}%
    \begin{boxedminipage}{\textwidth}
        \raggedright \textbf{#1}(#2)}
    {\end{boxedminipage}}

\newenvironment{EpydocDocstring}{%
    \@EpydocFunctionLine}
    {\vspace{1ex}}

\newenvironment{EpydocFunctionSignature}[1]{%
    \renewcommand{\and}{, }%
    \newcommand{\VarArg}[1]{*\textit{##1}}%
    \newcommand{\GenericArg}{\textit{\ldots}}%
    \newcommand{\KWArg}[1]{**\textit{##1}}%
    \newcommand{\Param}[2][]{%
        \textit{##2}%
        \ifthenelse{\equal{##1}{}}{}{=\texttt{##1}}}%
    \raggedright{\bfseries #1}(}
    {)}
    
\newenvironment{EpydocFunctionParameters}[1]{%
    \@EpydocFunctionLine
    \textbf{Parameters}%
    \begin{quote}
    \begin{Ventry}{#1}}
    {\end{Ventry}
    \end{quote}
    %\vspace{1ex}
    }
    
\newcommand{\EpydocFunctionReturns}[2][]{%
    \@EpydocFunctionLine
    \textbf{Return Value}%
    \begin{quote}
        \ifthenelse{\equal{#1}{}}{#2}{%
            #2 \textit{(type=#1)}%
        }
    \end{quote}
    %\vspace{1ex}
    }

\newenvironment{EpydocFunctionRaises}{%
    \renewcommand*{\descriptionlabel}[1]{\hspace\labelsep
       \normalfont\itshape ##1}
    \@EpydocFunctionLine
    \textbf{Raises}
    \begin{quote}
        \begin{description}
    }
    {\end{description}
    \end{quote}
    %\vspace{1ex}
    }

\newcommand{\EpydocFunctionOverrides}[2][0]{%
    \@EpydocFunctionLine
    Overrides: #2 %
    \ifthenelse{#1=1}{\textit{(inherited documentation)}{}}}
    
\newcommand{\EpydocInheritanceItem}[2]{Inherited from #1: #2}

\newenvironment{EpydocInheritanceList}{%
    \renewcommand{\item}[1][]{\textbf{Inherited from ##1:}}}
    {}

\newcommand{\EpydocDescriptionItem}[2]{%
    \textbf{#1:} #2}

\newenvironment{EpydocDescriptionShortList}[1]{%
    \newcommand{\and}{, }%
    \textbf{#1: }}
    {}

\newenvironment{EpydocDescriptionLongList}[1]{%
    \textbf{#1:}
    \begin{quote}
        \begin{itemize}
            \setlength{\parskip}{0.6ex}}
    {	\end{itemize}
    \end{quote}}

\newenvironment{EpydocClassList}{%
    \begin{itemize}
        \renewcommand{\makelabel}[1]{\textbf{##1}}
    \setlength{\parskip}{0ex}}
    {\end{itemize}}

\newenvironment{EpydocClassSubList}{%
    \newcommand{\CrossRef}[1]{%
        \textit{(Section \ref{##1}, p.~\pageref{##1})}}
    \begin{itemize}
        \renewcommand{\makelabel}[1]{\textbf{##1}}
    \setlength{\parskip}{0ex}}
    {\end{itemize}}
    
\newenvironment{EpydocModuleList}{%
    \newcommand{\CrossRef}[1]{%
        \textit{(Section \ref{##1}, p.~\pageref{##1})}}
    \begin{itemize}
        \renewcommand{\makelabel}[1]{\textbf{##1}}
    \setlength{\parskip}{0ex}}
    {\end{itemize}}

\newenvironment{EpydocModuleSubList}{%
    \begin{itemize}
        \renewcommand{\makelabel}[1]{\textbf{##1}}
    \setlength{\parskip}{0ex}}
    {\end{itemize}}

% \newenvironment{@EpydocGeneralList}{%
%     \newcommand{\EpydocInternalHeader}[1]{%
%         \multicolumn{2}{|l|}{\textbf{##1}} \\
%          \cline{1-2}}%
%     \newcommand{\EpydocInheritanceItemLine}[2]{%
%         \multicolumn{2}{|p{\textwidth}|}{%
%             \textbf{Inherited from {##1}: ##2}}}
%     \begin{longtable}{|p{.30\textwidth}|p{.62\textwidth}|l}
%     \cline{1-2}
%     % Set up the headers & footer (this makes the table span
%     % multiple pages in a happy way).
%     \cline{1-2} \centering \textbf{Name} & \centering \textbf{Description}& \\
%     \cline{1-2}
%     \endhead\cline{1-2}\multicolumn{3}{r}{\small\textit{continued on next page}}\\\endfoot\cline{1-2}
%     \endlastfoot}
%     {\end{longtable}}

\newenvironment{@EpydocGeneralList}{%
    \newcommand{\EpydocInternalHeader}[1]{%
        \multicolumn{2}{|l|}{\textbf{##1}} \\
         \hline}%
    \newcommand{\EpydocInheritanceItemLine}[2]{%
        \multicolumn{2}{|p{\textwidth}|}{%
            \textbf{Inherited from {##1}: ##2}}}
    \begin{longtable}{|p{.30\textwidth}|p{.62\textwidth}|}
    % Set up the headers & footer (this makes the table span
    % multiple pages in a happy way).
    \hline 
    \centering \textbf{Name} & \centering \textbf{Description} 
    \tabularnewline
    \hline
    \endhead\hline\multicolumn{2}{r}{\small\textit{continued on next page}}\\\endfoot\hline
    \endlastfoot}
    {\end{longtable}}

% \newenvironment{EpydocVariablesList}{%
%     \newenvironment{EpydocLongValue}{%
%         \begin{alltt}}
%         {\end{alltt}}%
%     \newcommand{\EpydocShortValue}[1]{\texttt{##1}}
%     \newcommand{\EpydocVariable}[4]{%
%         \raggedright ##1 & \raggedright ##2
%         \ifthenelse{\equal{##3}{}\AND\equal{##4}{}}{}{
%             \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
%             \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}}
%         & \\
%         \cline{1-2}}
%     \begin{@EpydocGeneralList}}
%     {\end{@EpydocGeneralList}}

% \newenvironment{EpydocVariablesList}{%
%     \newenvironment{EpydocLongValue}{%
%         \begin{alltt}}
%         {\end{alltt}}%
%     \newcommand{\EpydocShortValue}[1]{\texttt{##1}}
%     \newcommand{\EpydocVariable}[4]{%
%         \raggedright ##1 & \raggedright ##2
%         \ifthenelse{\equal{##3}{}\AND\equal{##4}{}}{}{
%             \ifthenelse{\equal{##2}{}}{}{
%             
%             }
%             \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
%             \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}}
%         & \\
%         \cline{1-2}}
%     \begin{@EpydocGeneralList}}
%     {\end{@EpydocGeneralList}}

\newenvironment{EpydocVariablesList}{%
    \newenvironment{EpydocLongValue}{%
        \begin{alltt}}
        {\end{alltt}}%
    \newcommand{\EpydocShortValue}[1]{\texttt{##1}}
    \newcommand{\EpydocVariable}[4]{%
        \raggedright ##1 & \raggedright ##2
        \ifthenelse{\equal{##3}{}\AND\equal{##4}{}}{}{%

            \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
            \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}}
        \tabularnewline
        \hline}
    \begin{@EpydocGeneralList}}
    {\end{@EpydocGeneralList}}

% \newenvironment{EpydocVariablesList}{%
%     \newenvironment{EpydocLongValue}{%
%         \begin{alltt}}
%         {\end{alltt}}%
%     \newcommand{\EpydocShortValue}[1]{\texttt{##1}}
%     \newcommand{\EpydocVariable}[4]{%
%         \raggedright ##1 & 
%           \def\@EpydocVariableSep{}
%           \def\@EpydocVariableValue{}
%           \def\@EpydocVariableType{}
%           \ifthenelse{\equal{##3}{}\AND\equal{##4}{}}{}{%
%               \ifthenelse{\equal{##2}{}}{}{\def\@EpydocVariableSep{
%               
%               }}%
%               \ifthenelse{\equal{##3}{}}{}{\def\@EpydocVariableValue{\textbf{Value:} ##3 }}
%               \ifthenelse{\equal{##4}{}}{}{\def\@EpydocVariableType{\textit{(type=##4)}}}}
%           \raggedright ##2 
%           \@EpydocVariableSep 
%           \@EpydocVariableValue \@EpydocVariableType}
%         & \\
%         \cline{1-2}}
%     \begin{@EpydocGeneralList}}
%     {\end{@EpydocGeneralList}}


% \newenvironment{EpydocVariablesList}{%
%     \newenvironment{EpydocLongValue}{%
%         \begin{alltt}}
%         {\end{alltt}}%
%     \newcommand{\EpydocShortValue}[1]{\texttt{##1}}
%     \newcommand{\EpydocVariable}[4]{%
%         \raggedright ##1 & \raggedright%
%         \ifthenelse{\equal{##2}{}}{
%             \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
%             \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}}
%         {\ifthenelse{\equal{##3}{}\AND\equal{##4}{}}{##2}{##2
%             
%             \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
%             \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}}}
%         & \\
%         \cline{1-2}}
%     \begin{@EpydocGeneralList}}
%     {\end{@EpydocGeneralList}}

% \newenvironment{EpydocVariablesList}{%
%     \newenvironment{EpydocLongValue}{%
%         \begin{alltt}}
%         {\end{alltt}}%
%     \newcommand{\EpydocShortValue}[1]{\texttt{##1}}
%     \newcommand{\EpydocVariable}[4]{%
%         \raggedright ##1 & \raggedright%
%         \ifthenelse{\equal{##2}{}}{
%             \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
%             \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}}
%         {\ifthenelse{\equal{##3}{}\AND\equal{##4}{}}{##2}{##2
%             
%             \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
%             \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}}}
%         & \\
%         \cline{1-2}}
%     \begin{@EpydocGeneralList}}
%     {\end{@EpydocGeneralList}}

\newenvironment{EpydocClassVariablesList}{%
    \begin{EpydocVariablesList}}
    {\end{EpydocVariablesList}}

\newenvironment{EpydocInstanceVariablesList}{%
    \begin{EpydocVariablesList}}
    {\end{EpydocVariablesList}}

% \newenvironment{EpydocVariableList}{%
%     \newcommand{\EpydocInternalHeader}[1]{%
%         \multicolumn{2}{|l|}{\textbf{##1}\\
%         \cline{1-2}}}%
%     \newenvironment{EpydocLongValue}{%
%         \begin{alltt}}
%         {\end{alltt}}%
%     \newcommand{\EpydocShortValue}[1]{\texttt{##1}}
%     \newcommand{\EpydocVariable}[4]{%
%         \raggedright ##1 &
%         \ifthenelse{\equal{##3}{}\AND\equal{##4}{}}{}{\raggedright}
%         \ifthenelse{\equal{##3}{}}{}{\textbf{Value:} ##3 }
%         \ifthenelse{\equal{##4}{}}{}{\textit{(type=##4)}}
%         & \\
%         \cline{1-2}}
% %                 \renewcommand{\EpydocHyperlink}[2]{%
% %                 ####2 \textit{(p.~\pageref{####1})}}%
% %     \newcommand{\@EpydocInheritedFrom}{}
% %     \renewcommand{\EpydocHyperlink}[2]{%
% %         \ifthenelse{\equal{\@EpydocInheritedFrom}{}}{%
% %             \typeout{TRUE!!}
% %             \global\@EpydocInheritedFrom
% %             ##2 \renewcommand{\@EpydocInheritedFrom}{##1}}{%
% %             \typeout{FALSE!!}
% %             ##2 \texit{(p.~\pageref{\@EpydocInheritedFrom})}}}
%     \newcommand{\EpydocInheritanceItemLine}[2]{%
%         \multicolumn{2}{|p{\textwidth}|}{%
%             \textbf{Inherited from {##1}: ##2}}}
%     \begin{longtable}{|p{.30\textwidth}|p{.62\textwidth}|l}
%     \cline{1-2}
%     % Set up the headers & footer (this makes the table span
%     % multiple pages in a happy way).
%     \cline{1-2} \centering \textbf{Name} & \centering \textbf{Description}& \\
%     \cline{1-2}
%     \endhead\cline{1-2}\multicolumn{3}{r}{\small\textit{continued on next page}}\\\endfoot\cline{1-2}
%     \endlastfoot}
%     {\end{longtable}}

\newenvironment{EpydocPropertiesList}{%
    \newcommand{\EpydocProperty}[2]{%
        \raggedright ##1 &
        \ifthenelse{\equal{##2}{}}{}{\raggedright ##2}
        & \\
        \cline{1-2}}
    \begin{EpydocVariablesList}}
    {\end{EpydocVariablesList}}

% \newenvironment{EpydocPropertyList}{%
%     \newcommand{\EpydocInternalHeader}[1]{%
%         \multicolumn{2}{|l|}{\textbf{##1}\\
%         \cline{1-2}}}%
%     \newcommand{\EpydocProperty}[2]{%
%         \raggedright ##1 &
%         \ifthenelse{\equal{##2}{}}{}{\raggedright ##2}
%         & \\
%         \cline{1-2}}
%     \newcommand{\EpydocInheritanceItemLine}[2]{%
%         \multicolumn{2}{|p{\textwidth}|}{%
%             \textbf{Inherited from {##1}: ##2}}}
%     \begin{longtable}{|p{.30\textwidth}|p{.62\textwidth}|l}
%     \cline{1-2}
%     % Set up the headers & footer (this makes the table span
%     % multiple pages in a happy way).
%     \cline{1-2} \centering \textbf{Name} & \centering \textbf{Description}& \\
%     \cline{1-2}
%     \endhead\cline{1-2}\multicolumn{3}{r}{\small\textit{continued on next page}}\\\endfoot\cline{1-2}
%     \endlastfoot}
%     {\end{longtable}}

% \newenvironment{EpydocVariableList}{%
%     \newcommand{\EpydocVariableHeader}[1]{%
%         \multicolumn{2}{|l|}{\textbf{##1}\\
%         \cline{1-2}}}%
%     \newenvironment{EpydocLongValue}{%
%         \begin{alltt}}
%         {\end{alltt}}%
%     \renewcommand{\EpydocInheritanceItem}[2]{%
%         ##1 & ##2 & \\}
% %     \renewcommand{\EpydocInheritanceItem}[2]{%
% %         \multicolumn{2}{|p{\textwidth}|}{%
% % %             \renewcommand{\EpydocHyperlink}[2]{%
% % %                 ####2 \textit{(p.~\pageref{####1})}}
% %             \textbf{Inherited from ##1: ##2}}}
% %     \renewenvironment{EpydocInheritanceList}{%
% %         \newcommand{\EpydocShortValue}[1]{\texttt{####1}}
% %         \newcommand{\EpydocVariable}[4]{%
% %             \raggedright ####1 &
% %             \ifx####3\empty
% %                 \ifx####4\empty
% %                 \else
% %                     \raggedright
% %                 \fi
% %             \else
% %                 \raggedright
% %             \fi
% %             \ifx####3\empty\else\textbf{Value:} ####3 \fi
% %             \ifx####4\empty\else\textit{(type=####4)}\fi
% %             & \\
% %             \cline{1-2}
% %             }
% %         \begin{longtable}{|p{.30\textwidth}|p{.62\textwidth}|l}
% %         \cline{1-2}
% %         % Set up the headers & footer (this makes the table span
% %         % multiple pages in a happy way).
% %         \cline{1-2} \centering \textbf{Name} & \centering \textbf{Description}& \\
% %         \cline{1-2}
% %         \endhead\cline{1-2}\multicolumn{3}{r}{\small\textit{continued on next page}}\\\endfoot\cline{1-2}
% %         \endlastfoot}
% %         {\end{longtable}}
%     }
%     {\cline{1-2}}

\newenvironment{reSTadmonition}[1][]{%
    \begin{center}\begin{sffamily}
        \begin{lrbox}{\@tempboxa}
            \begin{minipage}{\admonitionwidth}
                \textbf{\large #1}
                \vspace{2mm}
    }
    {
        \end{minipage}
    \end{lrbox}
    \fbox{\usebox{\@tempboxa}}
    \end{sffamily}
    \end{center}
    }

\newcommand{\EpydocDottedName}[1]{#1}